<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Noto Serif SC:300,300italic,400,400italic,700,700italic|Lobster Two:300,300italic,400,400italic,700,700italic|EB Garamond:300,300italic,400,400italic,700,700italic|Source Code Pro:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"wadmes.github.io","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"buttons","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"./public/search.xml"};
  </script>

  <meta name="description" content="人生注定是一个人的旅行，但就算孤独也要做一直前行的人啊">
<meta property="og:type" content="website">
<meta property="og:title" content="NEWAY">
<meta property="og:url" content="http://wadmes.github.io/index.html">
<meta property="og:site_name" content="NEWAY">
<meta property="og:description" content="人生注定是一个人的旅行，但就算孤独也要做一直前行的人啊">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Li Wei">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://wadmes.github.io/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>NEWAY - 愿识乾坤大，仍怜草木青</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --></head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">NEWAY</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">愿识乾坤大，仍怜草木青</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
        <li class="menu-item menu-item-reading-notes">

    <a href="/notes" rel="section"><i class="fas fa-book-reader fa-fw"></i>Reading notes</a>

  </li>
        <li class="menu-item menu-item-about-me">

    <a href="/about" rel="section"><i class="fas fa-user fa-fw"></i>About me</a>

  </li>
        <li class="menu-item menu-item-official-about-me">

    <a href="/cv" rel="section"><i class="fas fa-user-secret fa-fw"></i>Official About me</a>

  </li>
        <li class="menu-item menu-item-resume">

    <a href="/cv/cv_liwei/cv.pdf" rel="section"><i class="fas fa-file fa-fw"></i>Resume</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://wadmes.github.io/2026/01/15/2026%E5%B9%B41%E6%9C%88/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/liwei3.jpg">
      <meta itemprop="name" content="Li Wei">
      <meta itemprop="description" content="人生注定是一个人的旅行，但就算孤独也要做一直前行的人啊">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="NEWAY">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2026/01/15/2026%E5%B9%B41%E6%9C%88/" class="post-title-link" itemprop="url">2026年一月的随笔</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2026-01-15 17:07:43 / Modified: 19:11:55" itemprop="dateCreated datePublished" datetime="2026-01-15T17:07:43-05:00">2026-01-15</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/life/" itemprop="url" rel="index"><span itemprop="name">life</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2026/01/15/2026%E5%B9%B41%E6%9C%88/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2026/01/15/2026%E5%B9%B41%E6%9C%88/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>现在是2026年的1月15日，我交完了所有值得的appliacations</p>
<p>心流。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://wadmes.github.io/2025/09/30/%E7%BB%99%E4%BD%A0%E7%9A%84%E4%BF%A1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/liwei3.jpg">
      <meta itemprop="name" content="Li Wei">
      <meta itemprop="description" content="人生注定是一个人的旅行，但就算孤独也要做一直前行的人啊">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="NEWAY">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/09/30/%E7%BB%99%E4%BD%A0%E7%9A%84%E4%BF%A1/" class="post-title-link" itemprop="url">2025年九月的随笔</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2025-09-30 17:07:43 / Modified: 11:54:35" itemprop="dateCreated datePublished" datetime="2025-09-30T17:07:43-04:00">2025-09-30</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/life/" itemprop="url" rel="index"><span itemprop="name">life</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2025/09/30/%E7%BB%99%E4%BD%A0%E7%9A%84%E4%BF%A1/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2025/09/30/%E7%BB%99%E4%BD%A0%E7%9A%84%E4%BF%A1/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=86 src="//music.163.com/outchain/player?type=2&id=1974443815&auto=1&height=66"></iframe>

<p>Neway，好久不见。</p>
<p>在现在落笔之前，我一直在酝酿给Lucas写的信，我想告诉他现在的世界是怎样的，想告诉他爸爸妈妈有多爱他。但忽然某一刻，我认知到，也许给他的信，不用刻意写出来，他成长的每个瞬间的我的陪伴，就是最好的注脚。</p>
<p>但是我必须要和你聊会了。每次当我回过头读那些写给我们的信时，我都能立马捕捉到我在那个当下的情绪甚至画面。因此，在这个发生了太多事的2025年，在这个也许是人生最大节点的时候，我必须写点什么了。</p>
<p>我不知道读这封信的你会在哪里、从事怎样的工作，但我知道你能立刻感受到我现在的迷茫。</p>
<p>从我决定读博的时候，我就坚定的想找教职。最大的原因是因为我喜欢在台上教书、和学生们进行有趣精彩的思维碰撞——我到现在仍是如此，上周Blanton开会去了让我代一节课，对我来说，那也是一次无比有趣、放松的体验。</p>
<p>但是我并不是很卷的人。也许是在媳妇的陪伴下、在Jose的鼓励支持下、我庸庸碌碌但却乐呵乐呵的过了博士这五年，我不觉得牺牲自己的时间精力换取事业上的成功是很明智的一件事：人生有太多值得体验的事物。换句话说，我并不是那么的self-motivated。我不像马哥，zhuolun，Zhengqi，和他们聊的时候，我能明显感觉到他们有野心：这不一定是作为AP成功的充分条件、但一定是必要条件。</p>
<p>正因如此，让我犹豫找教职的另一个原因是，我害怕辜负了我的学生。我作为PI，没有足够的self-motivation，怎么可能可以motivate我的学生 让他们的PhD生涯成果满满、或者至少不用担心毕业前景呢？</p>
<p>另一方面，我觉得自己的high-level的vision很有限，当我只是independent researcher时，我只需要自己捣鼓自己感兴趣的东西。但如果我有需要对他们负责学生，我肯定不能就像现在这样想做啥做啥。因此，倘若我做了AP招了学生，这些忧虑会push我不得不多去和工业界、和前辈交流，不得不每天多看N篇论文，花比现在多得多的时间在research上。那这似乎又和我一直以来的看法冲突了：</p>
<blockquote>
<p>我不觉得牺牲自己的时间精力换取事业上的成功是很明智的一件事。</p>
</blockquote>
<p>我当然对research有兴趣。事实上，和上课类似，每次paper的讨论都让我很兴奋。那如果这么看，去公司做research scientist，也许才是最适合我的路？不需要对别人负责（或者说，我只需要对manager负责，完成TA对我的expectation）的同时还可以和一群聪明人探索尝试很fancy的东西。</p>
<p>但是你要让我下定决心走工业界，我也会开始犹豫、难断——我甚至会脑补一堆逻辑去推翻我之前的想法：比如学术界获得vision不一定就要导致花比现在多得多的时间在research上：你不需要deal with those messy coding and implementations。比如我的内心并不是害怕对人负责、而是害怕自己的能力不够导致辜负对ta的负责。</p>
<p>哎。</p>
<p>其实当我从旁观者的角度，我可以给自己一些宽慰的建议——譬如不管怎么选，最后结果肯定还不错，所以不用太纠结。但是真的让我自己选择时，我确实没法下定决心：</p>
<p>留美国？美国的政治环境、和父母相隔万里。</p>
<p>回中国？从17岁后就没在大陆长期生活过、大陆的生活、工作环境我习惯吗？一直听说很toxic，如果不习惯怎么办？这大概率是一条单向路。</p>
<p>去工业界？真的要改变自己长久以来的想法吗？</p>
<p>去学术界？之前已经说了。。</p>
<p>其实还有很多想说的，比如对LLM的看法。但是Neway 我要去开会了，那就贴一下之前朋友圈的碎碎念吧。</p>
<blockquote>
<p>我第一次lead的project是写一个要开源的版图分解工具。在抓耳挠腮的理解算法、码代码、debug的某个晚上，忽然发现老板十年前的某个formulation有缺陷，导致在某个case结果并不是最优解。</p>
<p>基于此，我顺利publish了第一篇一作ccfa。</p>
<p>之后AI火了，但对我来说 什么cnn gnn只是多了一个工具，可以让我更加得心应手的解决问题。</p>
<p>在这个过程中，我也偶尔会灵光一闪的想出一些自己很喜欢的idea，比如基于SDP的floorplan。</p>
<p>但自从LLM之后，尤其是在做LLM相关work的时候，我发现自己对科研的乐趣正在慢慢消失。我越发觉得自己不再是那个探索者、那个战士，我只是LLM雇佣的一个民工，负责抬着LLM横扫寰宇，甚至LLM也许根本都不需要我抬。</p>
<p>我曾经绞尽脑汁才发现的老板的bug，曾经的那些灵光一闪，对于LLM来说也许只需要合适的prompt或者Agent flow，然后就是几秒钟inference的事情。</p>
<p>我不知道怎么结尾，也不知道怎么和这个事实和解。人生的酸甜苦辣，真是有意思呐。</p>
</blockquote>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://wadmes.github.io/2025/01/25/2025-Survey-of-Netlist-Graph-Encoder/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/liwei3.jpg">
      <meta itemprop="name" content="Li Wei">
      <meta itemprop="description" content="人生注定是一个人的旅行，但就算孤独也要做一直前行的人啊">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="NEWAY">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/01/25/2025-Survey-of-Netlist-Graph-Encoder/" class="post-title-link" itemprop="url">Circuit Fusion Read Note</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2025-01-25 12:52:02" itemprop="dateCreated datePublished" datetime="2025-01-25T12:52:02-05:00">2025-01-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-01-31 13:36:41" itemprop="dateModified" datetime="2025-01-31T13:36:41-05:00">2025-01-31</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/study/" itemprop="url" rel="index"><span itemprop="name">study</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2025/01/25/2025-Survey-of-Netlist-Graph-Encoder/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2025/01/25/2025-Survey-of-Netlist-Graph-Encoder/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Circuit-Fusion"><a href="#Circuit-Fusion" class="headerlink" title="Circuit Fusion"></a>Circuit Fusion</h1><p>Basic idea: learn a fusion circuit embedding by fusing different modalities: RTL code, function description, netlist graph, RTL AST.</p>
<h2 id="Data"><a href="#Data" class="headerlink" title="Data"></a>Data</h2><p>41 RTL designs - 7,166 RTL sub-circuits - generating same function 57,328 sub-circuits (Each with 8 sub-circuits)</p>
<p>summary - coming from GPT4 (prompt input is the verilog code)<br>code - existing<br>graph - obtained by code. nodes are operators. </p>
<h3 id="How-circuit-is-divided-into-sub-circuits"><a href="#How-circuit-is-divided-into-sub-circuits" class="headerlink" title="How circuit is divided into sub-circuits?"></a>How circuit is divided into sub-circuits?</h3><h2 id="Training-details"><a href="#Training-details" class="headerlink" title="Training details"></a>Training details</h2><h3 id="Intra-modal-learning"><a href="#Intra-modal-learning" class="headerlink" title="Intra-modal learning"></a>Intra-modal learning</h3><ol>
<li>mask circuit graph nodes (operators, e.g., AND, XOR, MUX) and predict the masked nodes</li>
<li>intra-modal contrastive learning: positive sample - sub-circuits with the same functionality <ol>
<li>Q: How to create same functionality and ensure it is correct? A: using open-source tools, Yosys and ABC</li>
</ol>
</li>
</ol>
<h3 id="Cross-modal-alignment"><a href="#Cross-modal-alignment" class="headerlink" title="Cross-modal alignment"></a>Cross-modal alignment</h3><h3 id="Multi-modal-fusion"><a href="#Multi-modal-fusion" class="headerlink" title="Multi-modal fusion"></a>Multi-modal fusion</h3><ol>
<li>Mask summary modeling</li>
</ol>
<p>Query: Masked summary embedding (randomly masking parts of high-level summary)</p>
<p>Key, Value: Mix-up of code-graph</p>
<blockquote>
<p>Q: why not simply mix-up everything and feed into a transformer (self-attention)</p>
</blockquote>
<ol start="2">
<li>Summary and mix-embedding matching</li>
</ol>
<h3 id="Alignment-w-Netlist-RTL"><a href="#Alignment-w-Netlist-RTL" class="headerlink" title="Alignment w. Netlist - RTL"></a>Alignment w. Netlist - RTL</h3><h2 id="What-is-RAG-inference-here"><a href="#What-is-RAG-inference-here" class="headerlink" title="What is RAG inference here?"></a>What is RAG inference here?</h2><h2 id="Evaluation-what-tasks"><a href="#Evaluation-what-tasks" class="headerlink" title="Evaluation: what tasks?"></a>Evaluation: what tasks?</h2><ol>
<li>predicting slack for each individual register (sub-circuit level)</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">slack calcuation example (thanks deepseek)</span><br><span class="line"></span><br><span class="line">假设一个设计中：</span><br><span class="line"></span><br><span class="line">目标时钟周期：1ns（1GHz）</span><br><span class="line"></span><br><span class="line">组合逻辑延迟：0.7ns</span><br><span class="line"></span><br><span class="line">寄存器Setup Time：0.1ns</span><br><span class="line"></span><br><span class="line">CLK to Q</span><br><span class="line">D input</span><br><span class="line">Q OUTPUT</span><br><span class="line"></span><br><span class="line">时钟Skew：0.05ns</span><br><span class="line"></span><br><span class="line">计算Setup Slack：</span><br><span class="line"></span><br><span class="line">Copy</span><br><span class="line">Slack = (1ns - 0.05ns) - (0.7ns + 0.1ns) = 0.95ns - 0.8ns = 0.15ns  </span><br><span class="line">Slack为正，满足时序要求。若组合逻辑延迟增加到0.9ns，则Slack为-0.05ns（时序违例）。</span><br></pre></td></tr></table></figure>

<ol>
<li>worst negative slack (WNS) prediction</li>
<li>total negative slack (TNS) prediction</li>
<li>power prediction</li>
<li>area prediction</li>
</ol>
<p>The four above is circuit level</p>
<blockquote>
<p>Q: how to use sub-circuit emebeddings to do circuit level predictions? Concat? If concat, how to handle the number of sub-circuits that changes for each design? A: They add them up. And then concat with some design-level features (what is included in their exp), and then use a regression model.<br>Q: This compares with SNS v2, but it seems to not publish the code?</p>
</blockquote>
<p>Note: in circuit-level tasks, they include design level features, e.g., number of different operator types. We need to figure out what features they use. </p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://wadmes.github.io/2024/10/23/Autograder%E7%AE%80%E5%8D%95%E7%9A%84%E4%B8%AD%E6%96%87%E6%95%99%E7%A8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/liwei3.jpg">
      <meta itemprop="name" content="Li Wei">
      <meta itemprop="description" content="人生注定是一个人的旅行，但就算孤独也要做一直前行的人啊">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="NEWAY">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/10/23/Autograder%E7%AE%80%E5%8D%95%E7%9A%84%E4%B8%AD%E6%96%87%E6%95%99%E7%A8%8B/" class="post-title-link" itemprop="url">Autograder简单的中文教程</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-10-23 11:41:30" itemprop="dateCreated datePublished" datetime="2024-10-23T11:41:30-04:00">2024-10-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-10-25 13:04:37" itemprop="dateModified" datetime="2024-10-25T13:04:37-04:00">2024-10-25</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/study/" itemprop="url" rel="index"><span itemprop="name">study</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2024/10/23/Autograder%E7%AE%80%E5%8D%95%E7%9A%84%E4%B8%AD%E6%96%87%E6%95%99%E7%A8%8B/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2024/10/23/Autograder%E7%AE%80%E5%8D%95%E7%9A%84%E4%B8%AD%E6%96%87%E6%95%99%E7%A8%8B/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>前段时间想给一个作业写一个autograder，翻遍网上发现没有中文教程，遂作此文。（也是给自己留个备份 方便之后直接看）</p>
<p>首先准备一个文件夹 <code>autograder_folder</code>。注意这个文件夹里的内容会被上传到服务器中的<code>/autograder/source</code></p>
<h2 id="第一步"><a href="#第一步" class="headerlink" title="第一步"></a><strong>第一步</strong></h2><p>创建<code>setup.sh</code>，这个是autograder server第一个执行的脚本，一般来说，你可以用来给autograder server装环境。例子：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env bash</span><br><span class="line"></span><br><span class="line">apt-get install -y python3 python3-pip python3-dev</span><br><span class="line"></span><br><span class="line">pip3 install -r /autograder/source/requirements.txt # /autograder/source 就是你创建的autograder_folder</span><br><span class="line"></span><br><span class="line">cd /autograder/source/cframe/</span><br><span class="line"></span><br><span class="line">python3 setup.py install</span><br><span class="line"></span><br><span class="line">cd /</span><br></pre></td></tr></table></figure>


<h2 id="第二步"><a href="#第二步" class="headerlink" title="第二步"></a>第二步</h2><p>创建一个脚本<code>run_autograder</code>， 其中的内容大概就是</p>
<ol>
<li>复制学生的submission（在<code>/autograder/submission</code> 里面）到某个你需要的地方</li>
<li>跑学生的submission</li>
<li>grading</li>
</ol>
<p>例子</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env bash</span><br><span class="line"></span><br><span class="line"># Set up autograder files</span><br><span class="line"></span><br><span class="line">find /autograder/submission -name &quot;imply.py&quot; -exec cp &#123;&#125; /autograder/source/imply.py \; # 这里就是把文件转移到source文件夹</span><br><span class="line"></span><br><span class="line">cd /autograder/source</span><br><span class="line">mkdir logs</span><br><span class="line"># mv project2/imply.py imply.py</span><br><span class="line">BENCH=/autograder/source/bench</span><br><span class="line">echo &quot;running user tests&quot;</span><br><span class="line">timeout 10s python3 imply.py $BENCH/c7.bench $BENCH/c7.1.impl  result/c7.1</span><br><span class="line">echo &quot;finished running user&quot;</span><br><span class="line">echo &quot;------------------------&quot;</span><br><span class="line"></span><br><span class="line">echo &quot;running scoring system&quot;</span><br><span class="line">cd /autograder/source/</span><br><span class="line"></span><br><span class="line">python3 run_all_submission.py。#</span><br><span class="line"></span><br><span class="line">echo &quot;finished running scoring system&quot;</span><br><span class="line">echo &quot;------------------------&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">python3 run_tests.py</span><br></pre></td></tr></table></figure>

<h2 id="Grading"><a href="#Grading" class="headerlink" title="Grading?"></a>Grading?</h2><p>grade需要两个文件，<code>run_tests.py</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">import unittest</span><br><span class="line">from gradescope_utils.autograder_utils.json_test_runner import JSONTestRunner</span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    suite = unittest.defaultTestLoader.discover(&#x27;tests&#x27;) # 这里就是看tests文件夹里面所有的test.py</span><br><span class="line">    with open(&#x27;/autograder/results/results.json&#x27;, &#x27;w&#x27;) as f:</span><br><span class="line">        JSONTestRunner(visibility=&#x27;visible&#x27;, stream=f,stdout_visibility = &#x27;visible&#x27;).run(suite)</span><br></pre></td></tr></table></figure>

<p>和 <code>tests/test.py</code><br>下面是我的例子，主要看下每个func 的前缀，很好理解。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line">import unittest</span><br><span class="line">import random</span><br><span class="line">from gradescope_utils.autograder_utils.decorators import partial_credit, visibility</span><br><span class="line">import os</span><br><span class="line">import re</span><br><span class="line"></span><br><span class="line">class TestPartialCredit(unittest.TestCase):</span><br><span class="line">    def setUp(self):</span><br><span class="line">        pass</span><br><span class="line"></span><br><span class="line">    @visibility(&#x27;after_due_date&#x27;)</span><br><span class="line">    @partial_credit(70.0)</span><br><span class="line">    def test_fanout_free(self, set_score=None):</span><br><span class="line">            with open(f&quot;./result_sort/log&quot;, &#x27;r&#x27;) as IN:</span><br><span class="line">                fanout_free = 0</span><br><span class="line">                fanout = 0</span><br><span class="line">                xlist = 0</span><br><span class="line">                unique = 0</span><br><span class="line">                for line in IN:</span><br><span class="line">                    line = line.strip()</span><br><span class="line">                    score = 0</span><br><span class="line">                    if &quot;:&quot; in line:</span><br><span class="line">                        score = float(line.split(&quot;:&quot;)[1].strip())</span><br><span class="line">                    if re.match(r&#x27;^c7\.(\d)&#x27;, line):</span><br><span class="line">                        fanout_free += score</span><br><span class="line">                    elif re.match(r&#x27;^nand\.(\d)&#x27;, line):</span><br><span class="line">                        fanout_free += score</span><br><span class="line">                    elif re.match(r&#x27;^or\.(\d)&#x27;, line):</span><br><span class="line">                        fanout_free += score</span><br><span class="line">                    else:</span><br><span class="line">                        continue</span><br><span class="line">                    print(f&quot;line=&#123;line&#125;, this benchmark&#x27;s score=&#123;score&#125;, fanout_free cumulative score=&#123;fanout_free&#125;&quot;)</span><br><span class="line">                    </span><br><span class="line">                fanout_free = fanout_free * 10</span><br><span class="line">                &quot;&quot;&quot;Sets partial credit&quot;&quot;&quot;</span><br><span class="line">                set_score(fanout_free + 10)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @partial_credit(30.0)</span><br><span class="line">    @visibility(&#x27;after_due_date&#x27;)</span><br><span class="line">    def test_fanout(self, set_score=None):</span><br><span class="line">            with open(f&quot;./result_sort/log&quot;, &#x27;r&#x27;) as IN:</span><br><span class="line">                fanout_free = 0</span><br><span class="line">                fanout = 0</span><br><span class="line">                xlist = 0</span><br><span class="line">                unique = 0</span><br><span class="line">                for line in IN:</span><br><span class="line">                    line = line.strip()</span><br><span class="line">                    score = 0</span><br><span class="line">                    if &quot;:&quot; in line:</span><br><span class="line">                        score = float(line.split(&quot;:&quot;)[1].strip())</span><br><span class="line">                    if re.match(r&#x27;^c7\.(\d)&#x27;, line):</span><br><span class="line">                        fanout_free += score</span><br><span class="line">                    elif re.match(r&#x27;^nand\.(\d)&#x27;, line):</span><br><span class="line">                        fanout_free += score</span><br><span class="line">                    elif re.match(r&#x27;^or\.(\d)&#x27;, line):</span><br><span class="line">                        fanout_free += score</span><br><span class="line">                    elif &quot;xlist&quot; in line:</span><br><span class="line">                        xlist += score</span><br><span class="line">                        xlist = xlist * 10</span><br><span class="line">                    elif &quot;unique&quot; in line:</span><br><span class="line">                        unique += score</span><br><span class="line">                        unique = unique * 10</span><br><span class="line">                    else:</span><br><span class="line">                        fanout += score</span><br><span class="line">                        print(f&quot;line=&#123;line&#125;, this benchmark&#x27;s score=&#123;score&#125;, fanout cumulative score=&#123;fanout&#125;&quot;)</span><br><span class="line">                    </span><br><span class="line"></span><br><span class="line">                fanout = fanout * 5</span><br><span class="line">                set_score(fanout)</span><br><span class="line">    </span><br><span class="line">    @partial_credit(20.0)</span><br><span class="line">    @visibility(&#x27;after_due_date&#x27;)</span><br><span class="line">    def test_extra(self, set_score=None):</span><br><span class="line">            with open(f&quot;./result_sort/log&quot;, &#x27;r&#x27;) as IN:</span><br><span class="line">                fanout_free = 0</span><br><span class="line">                fanout = 0</span><br><span class="line">                xlist = 0</span><br><span class="line">                unique = 0</span><br><span class="line">                for line in IN:</span><br><span class="line">                    line = line.strip()</span><br><span class="line">                    score = 0</span><br><span class="line">                    if &quot;:&quot; in line:</span><br><span class="line">                        score = float(line.split(&quot;:&quot;)[1].strip())</span><br><span class="line">                    if re.match(r&#x27;^c7\.(\d)&#x27;, line):</span><br><span class="line">                        fanout_free += score</span><br><span class="line">                    elif re.match(r&#x27;^nand\.(\d)&#x27;, line):</span><br><span class="line">                        fanout_free += score</span><br><span class="line">                    elif re.match(r&#x27;^or\.(\d)&#x27;, line):</span><br><span class="line">                        fanout_free += score</span><br><span class="line">                    elif &quot;xlist&quot; in line:</span><br><span class="line">                        xlist += score</span><br><span class="line">                        xlist = xlist * 10</span><br><span class="line">                        print(f&quot;line=&#123;line&#125;, this benchmark&#x27;s score=&#123;score&#125;, xlist cumulative score=&#123;xlist&#125;, unique cumulative score=&#123;unique&#125;&quot;)</span><br><span class="line">                    elif &quot;unique&quot; in line:</span><br><span class="line">                        unique += score</span><br><span class="line">                        unique = unique * 10</span><br><span class="line">                        print(f&quot;line=&#123;line&#125;, this benchmark&#x27;s score=&#123;score&#125;, xlist cumulative score=&#123;xlist&#125;, unique cumulative score=&#123;unique&#125;&quot;)</span><br><span class="line">                    else:</span><br><span class="line">                        fanout += score</span><br><span class="line">                extra = xlist + unique</span><br><span class="line">            set_score(extra)</span><br><span class="line">    </span><br><span class="line">    @partial_credit(10.0)</span><br><span class="line">    @visibility(&#x27;after_due_date&#x27;)</span><br><span class="line">    def test_clarity(self, set_score=None):</span><br><span class="line">        set_score(10)</span><br><span class="line">        </span><br></pre></td></tr></table></figure>

<h2 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h2><p>注意不要压缩<code>autograder_folder</code> 这个文件夹，<br>要选中<code>autograder_folder</code>里面的所有文件然后压缩</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://wadmes.github.io/2024/06/17/2024%E5%B9%B4%E4%BA%94%E6%9C%88%E7%9A%84%E9%9A%8F%E7%AC%94/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/liwei3.jpg">
      <meta itemprop="name" content="Li Wei">
      <meta itemprop="description" content="人生注定是一个人的旅行，但就算孤独也要做一直前行的人啊">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="NEWAY">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/06/17/2024%E5%B9%B4%E4%BA%94%E6%9C%88%E7%9A%84%E9%9A%8F%E7%AC%94/" class="post-title-link" itemprop="url">2024年六月的随笔</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2024-06-17 20:07:43 / Modified: 20:11:17" itemprop="dateCreated datePublished" datetime="2024-06-17T20:07:43-04:00">2024-06-17</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/life/" itemprop="url" rel="index"><span itemprop="name">life</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2024/06/17/2024%E5%B9%B4%E4%BA%94%E6%9C%88%E7%9A%84%E9%9A%8F%E7%AC%94/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2024/06/17/2024%E5%B9%B4%E4%BA%94%E6%9C%88%E7%9A%84%E9%9A%8F%E7%AC%94/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=86 src="//music.163.com/outchain/player?type=2&id=1974443815&auto=1&height=66"></iframe>

<h1 id="武侠和科研"><a href="#武侠和科研" class="headerlink" title="武侠和科研"></a>武侠和科研</h1><p>最近通关了一款武侠游戏，逸剑风云决。我在steam上的评论有了快一百点赞：</p>
<blockquote>
<p>我也算是个科研工作者，在我看来科研世界和武侠世界有很多相似之处。 </p>
<p>有江湖 有师傅 有人情世故，每个组（门派）有自己擅长的领域。</p>
<p>做的最好的教授就像那些一代宗师们，而我们就是“初出茅庐”“炉火纯青”的小年轻。</p>
<p>而宇文逸的故事真的有给到我激励：不论处在什么位置，保持善良、保持初心，努力学习，坚持正义，作出一些为国为民的贡献，便是自己的侠心，每个人都能做到的侠心。</p>
</blockquote>
<p>其实我年少时并没怎么读过金庸：在我那个年纪读“武侠小说”不算是“正经事”的。不过我有幸读完了成语故事，并且对里面的各种历史故事颇有兴致，也许我是那时起便埋藏了对自己这个民族、文化的热爱。</p>
<p>我真正接触武侠是到了大学。从侠客风云传到射雕英雄传，最开始的喜欢其实更多是因为它游戏中能带给人的“爽感”：主角获得绝世神功完成复仇，迎娶意中人，这样的故事是我这样的青年喜闻乐见的。</p>
<p>不知何时起，我喜欢的武侠不再是那些武林绝学、江湖奇遇，反而是郭靖守襄阳的义不容辞、黄蓉陪伴郭靖的生死相随。在我看来，这些品质，是超脱于那些江湖、绝学之上的，更为难得、并且更值得我们学习的。</p>
<p>也许是“有人的地方就有江湖”，另一方面让我觉得有意思的是，在这种武侠游戏中，经常会有  把我逗笑、让我觉得和自己的生活好像 的情况。</p>
<p>主角参加武林大会，和各路没见过的掌门帮主问好，掌门帮主们第一句话就是问你是不是xx（武当掌门）的关门弟子。</p>
<p>😆</p>
<p>这不就是我去DAC开会和各路大佬们打招呼，他们都会问我是哪个学校、导师是谁一模一样？</p>
<p>然后各个门派的招式就是各个组擅长的领域。有的组擅长phyiscal design，有的组用ML比较多。。。类比起来就是 少林打拳的多，姑苏家很喜欢用斗转星移之类的“妖术”。</p>
<p>那这么说我的SDP方法算不算自己发明了一门武功（虽然搁游戏里肯定就是一个白色最垃圾武功），但好歹也是个原创对不。😆</p>
<p>因此，我每每学一些新东西时、譬如RL，diffusion model，我总是莫名其妙会涌出一股兴奋感：卧槽，我可是在读一门武林绝学呢！这秘籍不用从猴子那拿、不用给神仙姐姐磕头，直接就给我了！</p>
<h1 id="遗憾和人生"><a href="#遗憾和人生" class="headerlink" title="遗憾和人生"></a>遗憾和人生</h1><blockquote>
<p>人生最大的遗憾，是一个人无法同时拥有青春和对青春的感受。</p>
</blockquote>
<p>最近实习去公司都是博一顺路接送我，所以每趟我们都在路上嗨聊。</p>
<p>自然聊到了一些人生中遗憾的事。</p>
<p>如果真要聊，我可以哔哩吧啦一大堆：</p>
<p>“我跟你说，我本来是个天生的画家，小学时xxx。。。”</p>
<p>“诶，我小时候还自己做游戏，无敌的”</p>
<p>。。。</p>
<p>但真要说最大的遗憾，我也许会投自己成熟的太晚一票。因为成熟的太晚、所以很多对人对事，不论是对朋友、还是感情上，都有太多让我后悔做过或是没做的事。</p>
<p>我可以把一部分原因怪罪于这个高考至上的教育体系，这个忽视人文关怀的体系让包括我在内的学生没能在青少年时代建立起良好的感情观、人生观，只能空叹“初闻不知曲中意，再闻已是曲中人”。</p>
<p>但是我没法把锅全甩给体系。</p>
<p>事实上，我很认同deft的那句话</p>
<blockquote>
<p>其实人生在世，是不太需要别人的建议的，不经历过不会明白的</p>
</blockquote>
<p>语文课本里面学过的东西其实足够我们安然幸福的度过人生：我们学过对待外物要“不以物喜，不以己悲”、对待结果要“尽吾志也而不能至者，可以无悔矣”，也见识过“山无陵，江水为竭”的轰轰烈烈的爱情。</p>
<p>但是不经历过是不会明白的。</p>
<p>只有经历过，才会想：如果当时我XXX就好了。这么说来人生似乎是注定有遗憾的，但也正是如此，所以我现在坚定的支持探索，去体验，去勇敢的做自己的选择。只有多去做、才能多经历、才能真正的学到怎么和这个世界、和他人、和自己相处。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://wadmes.github.io/2024/06/06/stableVSRL/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/liwei3.jpg">
      <meta itemprop="name" content="Li Wei">
      <meta itemprop="description" content="人生注定是一个人的旅行，但就算孤独也要做一直前行的人啊">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="NEWAY">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/06/06/stableVSRL/" class="post-title-link" itemprop="url">stabel diffusion 和 reinforcement learning 的优缺点对比</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2024-06-06 23:29:50 / Modified: 17:38:16" itemprop="dateCreated datePublished" datetime="2024-06-06T23:29:50-04:00">2024-06-06</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/study/" itemprop="url" rel="index"><span itemprop="name">study</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2024/06/06/stableVSRL/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2024/06/06/stableVSRL/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>今天开完会 和同学仔细讨论了下SD 和 RL，受益颇多，赶快记录一下</p>
</blockquote>
<h1 id="Stable-Diffusion"><a href="#Stable-Diffusion" class="headerlink" title="Stable Diffusion"></a>Stable Diffusion</h1><h2 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h2><ul>
<li>一般质量很高。（当然SD is only for generative task now) </li>
<li>可以生成很多样本</li>
<li>训练稳定</li>
</ul>
<blockquote>
<p>PS: 这几点可都是EDA engineer喜欢的呀</p>
</blockquote>
<h2 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h2><ul>
<li><p>需要“label” $x_0$</p>
</li>
<li><p>生成的样本 还是 在模仿”label”们的distribution，能不能超过label呢？这是个问题。如果不能超过“生成label的算法”的话，那么我们为什么不直接用“生成label的算法”？</p>
<blockquote>
<p>关于这个问题多说几句，目前我看到的回答是。</p>
<ol>
<li>没有“生成label的算法”，但我们也可以（反向）产生一堆100% accurate的label。比如我们的任务是 format A -&gt; format B。虽然没有A-&gt;B的完美算法，但是有B-&gt;A的完美算法。于是我们random generate B, and then get its corresponding A. which is our training data (A,B)</li>
<li>没有算法，但可以很方便收集到label，比如SD用来生成图像。</li>
</ol>
</blockquote>
</li>
</ul>
<h1 id="Reinforcement-Learning"><a href="#Reinforcement-Learning" class="headerlink" title="Reinforcement Learning"></a>Reinforcement Learning</h1><h2 id="优点-1"><a href="#优点-1" class="headerlink" title="优点"></a>优点</h2><ul>
<li>可用于各种问题，生成，决策，控制。</li>
<li>不需要“label”</li>
</ul>
<h2 id="缺点-1"><a href="#缺点-1" class="headerlink" title="缺点"></a>缺点</h2><ul>
<li>训练很不稳定</li>
<li>怎么定义”很好的”action,reward,这些是个大问题</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://wadmes.github.io/2024/04/08/stable-baselines3%E7%9A%84%E4%B8%80%E4%BA%9B%E5%B0%8F%E6%8A%80%E5%B7%A7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/liwei3.jpg">
      <meta itemprop="name" content="Li Wei">
      <meta itemprop="description" content="人生注定是一个人的旅行，但就算孤独也要做一直前行的人啊">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="NEWAY">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/04/08/stable-baselines3%E7%9A%84%E4%B8%80%E4%BA%9B%E5%B0%8F%E6%8A%80%E5%B7%A7/" class="post-title-link" itemprop="url">stable-baselines3的一些小技巧</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-04-08 20:29:50" itemprop="dateCreated datePublished" datetime="2024-04-08T20:29:50-04:00">2024-04-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-04-29 17:19:20" itemprop="dateModified" datetime="2024-04-29T17:19:20-04:00">2024-04-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/study/" itemprop="url" rel="index"><span itemprop="name">study</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2024/04/08/stable-baselines3%E7%9A%84%E4%B8%80%E4%BA%9B%E5%B0%8F%E6%8A%80%E5%B7%A7/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2024/04/08/stable-baselines3%E7%9A%84%E4%B8%80%E4%BA%9B%E5%B0%8F%E6%8A%80%E5%B7%A7/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Use-gym-wrapper"><a href="#Use-gym-wrapper" class="headerlink" title="Use gym wrapper"></a>Use gym wrapper</h1><p>需要重写 <code>reset()</code> and <code>step()</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">class TimeLimitWrapper(gym.Wrapper):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    :param env: (gym.Env) Gym environment that will be wrapped</span><br><span class="line">    :param max_steps: (int) Max number of steps per episode</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    def __init__(self, env, max_steps=100):</span><br><span class="line">        # Call the parent constructor, so we can access self.env later</span><br><span class="line">        super(TimeLimitWrapper, self).__init__(env)</span><br><span class="line">        self.max_steps = max_steps</span><br><span class="line">        # Counter of steps per episode</span><br><span class="line">        self.current_step = 0</span><br><span class="line"></span><br><span class="line">    def reset(self, **kwargs):</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        Reset the environment</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        # Reset the counter</span><br><span class="line">        self.current_step = 0</span><br><span class="line">        return self.env.reset(**kwargs)</span><br><span class="line"></span><br><span class="line">    def step(self, action):</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        :param action: ([float] or int) Action taken by the agent</span><br><span class="line">        :return: (np.ndarray, float, bool, bool, dict) observation, reward, is the episode over?, additional informations</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        self.current_step += 1</span><br><span class="line">        obs, reward, terminated, truncated, info = self.env.step(action)</span><br><span class="line">        # Overwrite the truncation signal when when the number of steps reaches the maximum</span><br><span class="line">        if self.current_step &gt;= self.max_steps:</span><br><span class="line">            truncated = True</span><br><span class="line">        return obs, reward, terminated, truncated, info</span><br></pre></td></tr></table></figure>

<p>当然，如果自己写<code>enviorment</code> 就不需要 写wrapper了</p>
<h1 id="logger-中的各种值"><a href="#logger-中的各种值" class="headerlink" title="logger 中的各种值"></a>logger 中的各种值</h1><h2 id="entropy-loss"><a href="#entropy-loss" class="headerlink" title="entropy_loss"></a>entropy_loss</h2><p><code>entropy_loss</code>: 负数值，越小代表预测的越不“自信”</p>
<p>if probs is [0.1,0.9]</p>
<p>entropy &#x3D; -0.1ln(0.1) - 0.9ln(0.9) &#x3D;~ 0.325</p>
<p>entropy_loss &#x3D; -0.325</p>
<p>if probs is [0.5,0.5]</p>
<p>entropy &#x3D; -0.5ln(0.5)-0.5ln(0.5) &#x3D;~ 0.69</p>
<h2 id="explained-variance"><a href="#explained-variance" class="headerlink" title="explained_variance"></a>explained_variance</h2><p><code>explained_variance</code>, 用于计算how well <strong>value function</strong> (or critic in actor-critic methods) match the actual returns<br>~&#x3D; 1: 完美<br>0: 和全预测一个值一样<br>&lt;0: 比简单预测mean还差</p>
<h1 id="RL-Tricks-I-found-in-internet"><a href="#RL-Tricks-I-found-in-internet" class="headerlink" title="RL Tricks I found in internet"></a>RL Tricks I found in internet</h1><h2 id="http-joschu-net-docs-nuts-and-bolts-pdf"><a href="#http-joschu-net-docs-nuts-and-bolts-pdf" class="headerlink" title="http://joschu.net/docs/nuts-and-bolts.pdf"></a><a target="_blank" rel="noopener" href="http://joschu.net/docs/nuts-and-bolts.pdf">http://joschu.net/docs/nuts-and-bolts.pdf</a></h2><ul>
<li><p>Premature drop in policy entropy ⇒ no learning</p>
<ul>
<li>Alleviate by using <strong>entropy bonus</strong> or KL penalty （鼓励randomness）</li>
</ul>
</li>
<li><p>I was confused as to what action I should take to improve my results after lots of experimentation whether feature engineering, reward shaping, more training steps, or algo hyper-parameter tuning. From lots of experiments, first and foremost look at your <strong>reward function</strong> and validate that the reward value for a given episode is representative for what you actually want to achieve - it took a lot of iterations to finally get this somewhat right. If you’ve checked and double checked your reward function, move to <strong>feature engineering</strong>. In my case, I was able to quickly test with feature answers (e.g. data that included information the policy was suppose to figure out) to realize that my reward function was not executing like it should. To that point, start small and simple and validate while making small changes. Don’t waste your time <strong>hyper-parameter tuning</strong> while you are still in development of your environment, observation space, action space, and reward function. While hyper-parameters make a huge difference, it won’t correct a bad reward function. In my experience, hyper-parameter tuning was able to identify the parameters to get to a higher reward quicker but that didn’t necessarily generalize to a better training experience. I used the hyper-parameter tuning as a starting point and then tweaked things manually from there.</p>
</li>
<li><p>Lastly, how much do you need to train - the million dollar question. This is going to significantly vary from problem to problem, I found success when the algo was able to process through any given episode 60+ times. This is the factor of exploration. Some problems&#x2F;environments need less exploration and others need more. The larger the observation space and the larger the action space, the more steps that are needed. For myself, I came up with this function <strong>needed_steps &#x3D; number_distinct_episodes * envs * episode_length</strong> mentioned in #2 based on how many times I wanted a given episode executed. Because my problem is data analytics focused, it was easy to determine how many distinct episodes I had, and then just needed to evaluate how many times I needed&#x2F;wanted a given episode explored. In other problems, there is no clear amount of distinct episodes and the rule of thumb that I followed was run for 1M steps and see how it goes, and then if I’m sure of everything else run for 5M steps, and then for 10M steps - though there are constraints on time and compute resources. I would also work in parallel in which I would make some change run a training job and then in a different environment make a different change and run another training job - this allowed me to validate changes pretty quickly of which path I wanted to go down killing jobs that I decided against without having to wait for it to finish - tmux was helpful for this.</p>
<ul>
<li>Comments to your last point: make more use of callbacks. <a target="_blank" rel="noopener" href="https://stable-baselines3.readthedocs.io/en/master/guide/callbacks.html">https://stable-baselines3.readthedocs.io/en/master/guide/callbacks.html</a> There are a lot of configured callbacks you can use to capture the best model, stop training on no improvement, regularly checkpoint… Lots of stuff. Be explicit about using Eval environment.</li>
</ul>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://wadmes.github.io/2024/03/25/%E6%BB%A1%E5%88%86%E4%BD%9C%E6%96%87/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/liwei3.jpg">
      <meta itemprop="name" content="Li Wei">
      <meta itemprop="description" content="人生注定是一个人的旅行，但就算孤独也要做一直前行的人啊">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="NEWAY">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/03/25/%E6%BB%A1%E5%88%86%E4%BD%9C%E6%96%87/" class="post-title-link" itemprop="url">Untitled</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-03-25 23:02:55" itemprop="dateCreated datePublished" datetime="2024-03-25T23:02:55-04:00">2024-03-25</time>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2024/03/25/%E6%BB%A1%E5%88%86%E4%BD%9C%E6%96%87/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2024/03/25/%E6%BB%A1%E5%88%86%E4%BD%9C%E6%96%87/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>穷乡僻壤，美丽乡村。乡党委书记是怎样使它蜕变？又用怎样的丹青勾勒出这如画风<br>景？<br>答道：以其信心，凭其决心，用其全心而已。<br>顿悟——人生如画，我以我心绘风景，绘出个草长莺飞，绘出个青山万丈，绘出一道<br>最亮丽的风景线！<br>我以信心绘风景，绘出一轮欲览的青天明月。五岁的她获得歌咏比赛一等奖，校长夸<br>奖道：“小姑娘，能拿冠军真是你的幸运。”她反抗道：“不，这是我应得的。”她是撒切<br>尔夫人，正是她的信心，使英国政坛多了一道迷人而又张扬的风景。<br>我凭决心绘风景，绘出一件已被黄沙打穿的金甲。乡党委书记凭着过人的决心建设乡<br>村，他成功了；孙权凭借“再有说者，便如此案”的决心，击败不可一世的曹操；邓艾凭<br>着“积军资之粮”的决心，以偏师平定蜀汉；项羽凭着破釜沉舟的决心，打败三十万秦<br>军……事例太多，但请君细想，若没有决心，曹操可能已一统天下，蜀汉仍能苟延残<br>喘，反秦势力可能烟消云散，那历史画卷中那些亮丽风景岂不消失殆尽？因此，我凭决<br>心绘风景，定要绘出“不破楼兰终不还”的豪情。<br>我用全心绘风景，绘出一派奋斗之花盛开的图景。乡党委书记用全心投入到乡村建<br>设，于是乡村焕然一新，而正值青春年少的我们，怎么有理由不全身心地投入到勾绘精<br>彩人生画卷之中去呢？但是，我看到了吊儿郎当的学生，我看到了沉迷灯红酒绿的青<br>年，他们的人生画卷黯淡无光。林清玄曾说：“我们要以全心来绽放，以花的姿态证明自<br>己的存在”。全心全意，只此四字，要做到却着实不易。孔明全身心地投入复兴汉室的伟<br>业中，即使失败也是一道风景；哈兰德•桑德斯退休后全心研究炸鸡方法，最终在街头巷<br>尾绘出一片“肯德鸡”的风景；科比全心练习篮球，在凌晨四点便开始训练，铸造了紫金<br>王朝那一抹风景。他们，或是儒生，或是老朽，或是“富二代”<br>，都全心投入各自坚守的<br>事业，亲手绘出一段段风景绚丽的人生卷轴，而我们又怎能轻易放弃？<br>每个人都有能力创造属于自己的风景，但需要信心、决心，更重要的是全心投入。如<br>此，蓦然回首，你会发现那风景已在灯火阑珊处。<br>我以我心绘风景，风景迷人因我心。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://wadmes.github.io/2024/03/14/Cython%E7%9A%84%E4%BC%98%E5%8C%96%E6%8C%87%E5%8D%97/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/liwei3.jpg">
      <meta itemprop="name" content="Li Wei">
      <meta itemprop="description" content="人生注定是一个人的旅行，但就算孤独也要做一直前行的人啊">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="NEWAY">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/03/14/Cython%E7%9A%84%E4%BC%98%E5%8C%96%E6%8C%87%E5%8D%97/" class="post-title-link" itemprop="url">Cython的优化指南</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-03-14 20:29:50" itemprop="dateCreated datePublished" datetime="2024-03-14T20:29:50-04:00">2024-03-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-03-15 00:14:33" itemprop="dateModified" datetime="2024-03-15T00:14:33-04:00">2024-03-15</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/study/" itemprop="url" rel="index"><span itemprop="name">study</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2024/03/14/Cython%E7%9A%84%E4%BC%98%E5%8C%96%E6%8C%87%E5%8D%97/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2024/03/14/Cython%E7%9A%84%E4%BC%98%E5%8C%96%E6%8C%87%E5%8D%97/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>很有用的资源<br>官方： <a target="_blank" rel="noopener" href="https://cython.readthedocs.io/en/latest/src/userguide/numpy_tutorial.html">https://cython.readthedocs.io/en/latest/src/userguide/numpy_tutorial.html</a><br>B站： <a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1NF411i74S/">https://www.bilibili.com/video/BV1NF411i74S/</a></p>
<h1 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h1><p>Cython可以在python中实现近似于C++的速度，基本方法是用类似于python的语法写<code>.pyx</code> 文件，然后再编译成python可以直接调用的library</p>
<p>编译需要一个<code>setup.py</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># setup.py</span><br><span class="line"></span><br><span class="line">from distutils.core import setup</span><br><span class="line">from distutils.extension import Extension</span><br><span class="line">from Cython.Distutils import build_ext</span><br><span class="line">from Cython.Build import cythonize</span><br><span class="line"></span><br><span class="line">setup(</span><br><span class="line">    ext_modules = cythonize(&quot;cython_module.pyx&quot;, annotate=True)</span><br><span class="line">)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>然后敲入入下代码就可以编译了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python setup.py build_ext --inplace</span><br></pre></td></tr></table></figure>

<p>Cython还提供了很方便的visualization，可以看implementation里面有哪些是C++ 哪些是python</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cython -a target.pyx</span><br></pre></td></tr></table></figure>

<p>例子：<br><img src="/./assets/17104695941068.jpg"></p>
<p>其中黄色越深，代表调用的Python API 越多，which means the efficiency is lower</p>
<h1 id="怎么优化"><a href="#怎么优化" class="headerlink" title="怎么优化"></a>怎么优化</h1><p>最常用的一般是下面几个要点</p>
<ul>
<li>在function前加上<code>@cython.wraparound(False) @cython.boundscheck(False) @cython.cdivision(True)</code>，避免python里面耗时间的boundscheck and so on （当然这样的话bound error就不会提示了，所以建议最后没bug了再加</li>
<li>标注function input和return 的type</li>
<li>标注所有要用到的variable 的type（包括numpy array 和 index，例如i j等） （就和c一样）</li>
<li>不要直接用numpy的api，要用就自己写</li>
</ul>
<p>效果如下，可以看到最后loop全部都白啦！</p>
<p><img src="/assets/17104739889217.jpg"></p>
<h1 id="其他小技巧-OpenMP-多线程加速"><a href="#其他小技巧-OpenMP-多线程加速" class="headerlink" title="其他小技巧 OpenMP 多线程加速"></a>其他小技巧 OpenMP 多线程加速</h1><p>在<code>.pyx</code> 中，加入如下prefix</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># distutils: extra_compile_args=-fopenmp</span><br><span class="line"># distutils: extra_link_args=-fopenmp</span><br></pre></td></tr></table></figure>

<p>然后在想要并行计算的for loop里用<code>prange</code>， 就可以啦：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># We use prange here.</span><br><span class="line">for x in prange(x_max, nogil=True):</span><br><span class="line">    for y in range(y_max):</span><br><span class="line"></span><br><span class="line">        tmp = clip(array_1[x, y], 2, 10)</span><br><span class="line">        tmp = tmp * a + array_2[x, y] * b</span><br><span class="line">        result_view[x, y] = tmp + c</span><br></pre></td></tr></table></figure>

<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>如果有些实现起来很简单，但是python因为type determine, memory allocation, bound check等 各种原因导致效率很慢，可以试着用cython来加速。效果很显著，最主要的是很容易就可以integrate into python, which is a must-have for DL work.</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://wadmes.github.io/2024/02/25/2024%E4%BA%8C%E6%9C%88%E7%9A%84%E7%A2%8E%E7%A2%8E%E5%BF%B5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/liwei3.jpg">
      <meta itemprop="name" content="Li Wei">
      <meta itemprop="description" content="人生注定是一个人的旅行，但就算孤独也要做一直前行的人啊">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="NEWAY">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/02/25/2024%E4%BA%8C%E6%9C%88%E7%9A%84%E7%A2%8E%E7%A2%8E%E5%BF%B5/" class="post-title-link" itemprop="url">2024二月的碎碎念</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2024-02-25 15:38:26 / Modified: 21:32:24" itemprop="dateCreated datePublished" datetime="2024-02-25T15:38:26-05:00">2024-02-25</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/life/" itemprop="url" rel="index"><span itemprop="name">life</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2024/02/25/2024%E4%BA%8C%E6%9C%88%E7%9A%84%E7%A2%8E%E7%A2%8E%E5%BF%B5/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2024/02/25/2024%E4%BA%8C%E6%9C%88%E7%9A%84%E7%A2%8E%E7%A2%8E%E5%BF%B5/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Hey Neway.</p>
<p>现在是2024年的二月底。</p>
<p>经历了一个冬天的“匡扶汉室”后，学期一开始，我忽然有了危机感。这种感觉很像高二时候的我：就是忽然觉得自己不能再这么玩乐下去了。</p>
<p>也许是因为游戏玩腻了。<br>也许是因为DAC又中了一篇对自己要求高了一些。<br>也许是因为算了算自己的毕业：忽然发现四年的话就只剩一年多一点了。</p>
<p>一直以来我对自己说的随遇而安、开心就好的“自我安慰”的体系，似乎土崩瓦解了。</p>
<p>就是忽然的，我开始想work，开始算自己的paper数。</p>
<p>从这点上，还是蛮羡慕高中的自己的。如果下定决心，只需要心无旁骛的学习，准备高考和自主招生就行。</p>
<p>但是成年人的世界却不像做题考试一样简单。这样的危机感不能让我专心工作，反而带来了很多焦虑。</p>
<p>我焦虑自己的德不配位。焦虑自己能不能四年毕业。焦虑毕业时找教职或者找工作有没有connection能帮到我，如果没有是不是得再去多找教授合作。</p>
<blockquote>
<p>德不配位这种焦虑时有发生，获得intern mentor赏识的时候；被告知Apple 很喜欢我的talk 又给了我fellowship的时候；Jose每次夸我good job的时候。当然这些时候也伴随着开心，但是开心之后就是很久的压抑。我知道自己的不足，我是个拖延症，我很多VLSI的background都欠缺，我甚至没跑个任何一个commercial EDA的flow，大学之后我也没有哪门课是真的想高中一样 感觉学到很多东西，甚至能得心应手的（天文除外）。</p>
</blockquote>
<p>不过还好，这些焦虑也没有很影响到我。我觉得得学习了，那么我只需要学就好了，用不着管前路如何。到了该conection谈合作的时候，去介绍自己发email就好了。就像小撒说的</p>
<blockquote>
<p>“我觉得自己是自由的。我不给自己的明天设置任何目标。我完全让时间这条河流带着我往前走，我就像躺在河面上的孩子一样，河流到哪，我就到哪，我只看天上的白云，不看前面”</p>
</blockquote>
<p>我经常会庆幸自己喜欢历史、也算“饱读过诗书”，所以这些压抑的负面的情绪，基本也都能消遣掉。竹杖芒鞋轻胜马，谁怕？一蓑烟雨任平生。</p>
<p>我很喜欢回过去看自己写的碎碎念。这真给了我一种穿越时空对话的感觉，同时很多时候也给了我无穷的精神力量。我想，未来某个时候的你，看到这篇文章，也会重温苏子当年给你的激励，也许也能帮你排解一些忧愁。</p>
<p>真好。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/15/">15</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Li Wei"
      src="/images/liwei3.jpg">
  <p class="site-author-name" itemprop="name">Li Wei</p>
  <div class="site-description" itemprop="description">人生注定是一个人的旅行，但就算孤独也要做一直前行的人啊</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">149</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">29</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/wadmes" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;wadmes" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:werry715@gmail.com" title="E-Mail → mailto:werry715@gmail.com" rel="noopener" target="_blank"><i class="fas fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://music.163.com/#/playlist?id=49000450" title="Music → https:&#x2F;&#x2F;music.163.com&#x2F;#&#x2F;playlist?id&#x3D;49000450" rel="noopener" target="_blank"><i class="fas fa-music fa-fw"></i>Music</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://steamcommunity.com/id/wadmes/" title="Steam → https:&#x2F;&#x2F;steamcommunity.com&#x2F;id&#x2F;wadmes&#x2F;" rel="noopener" target="_blank"><i class="fab fa-steam fa-fw"></i>Steam</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="link fa-fw"></i>
      Interesting links!
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://wadmes.github.io/2019/12/11/EDA-family-tree/" title="https:&#x2F;&#x2F;wadmes.github.io&#x2F;2019&#x2F;12&#x2F;11&#x2F;EDA-family-tree&#x2F;">EDA family tree</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://wenku.baidu.com/view/f5cdb37aeff9aef8951e0673" title="https:&#x2F;&#x2F;wenku.baidu.com&#x2F;view&#x2F;f5cdb37aeff9aef8951e0673" rel="noopener" target="_blank">小爷当年的高考满分作文</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2026</span>
  <span class="with-love">
    <i class="user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Li Wei</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a>
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  
  <script color='0,0,255' opacity='0.5' zIndex='-1' count='50' src="/lib/canvas-nest/canvas-nest.min.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : true,
      appId      : 'NmNqnbed4p8koRJWwGm6SdrW-gzGzoHsz',
      appKey     : 'ECnYjjxnwouXPYlJjrjLJhv9',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
